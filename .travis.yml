language: c

dist: xenial

compiler:
  - gcc
  - clang

sudo: required

env:
  matrix:
    - BUILD_TYPE=debug
      ENABLE_COVERAGE=OFF
      ENABLE_VALGRIND=OFF
      CONFIGURE_FLAGS="--enable-mcsat"
      TIME_LIMIT=60
    - BUILD_TYPE=debug
      ENABLE_COVERAGE=OFF
      ENABLE_VALGRIND=ON
      CONFIGURE_FLAGS="--enable-mcsat"
      TIME_LIMIT=600
    - BUILD_TYPE=debug
      ENABLE_COVERAGE=OFF
      ENABLE_VALGRIND=OFF
      CONFIGURE_FLAGS="--enable-thread-safety"
      TIME_LIMIT=60
    - BUILD_TYPE=debug
      ENABLE_COVERAGE=OFF
      ENABLE_VALGRIND=ON
      CONFIGURE_FLAGS="--enable-thread-safety"
      TIME_LIMIT=600
    - BUILD_TYPE=release
      ENABLE_COVERAGE=OFF
      ENABLE_VALGRIND=OFF
      CONFIGURE_FLAGS="--enable-mcsat"
      TIME_LIMIT=60
    - BUILD_TYPE=release
      ENABLE_COVERAGE=OFF
      ENABLE_VALGRIND=OFF
      CONFIGURE_FLAGS="--enable-thread-safety"
      TIME_LIMIT=60
    - BUILD_TYPE=gcov
      ENABLE_COVERAGE=ON
      ENABLE_VALGRIND=OFF
      CONFIGURE_FLAGS="--enable-mcsat"
      TIME_LIMIT=60

# command to install dependencies
install:
  - sudo apt-get update
  - sudo apt-get install -y libgmp-dev gperf
  - sudo apt-get install -y python-pip
  - sudo apt-get install -y lcov
  - sudo apt-get install -y valgrind
  - gem install coveralls-lcov

#tests
script:
  - ./.travis/build.sh

after_success:
  - if [[ $ENABLE_COVERAGE == ON ]]; then
      lcov --directory build --base-directory src --capture --output-file coverage.info;
      coveralls-lcov coverage.info;
    fi
